<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회의 마무리 - AI 회의록 서비스</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: white;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        /* 헤더 */
        .header {
            margin-bottom: 48px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e5e7eb;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: #dcfce7;
            color: #166534;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .meeting-title {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 16px;
            cursor: pointer;
            transition: color 0.2s;
            line-height: 1.3;
        }

        .meeting-title:hover {
            color: #3b82f6;
        }

        .meeting-meta {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            font-size: 14px;
            color: #6b7280;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* 메인 레이아웃 */
        .main-wrapper {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 48px;
            align-items: start;
        }

        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .area-title {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
        }

        /* 실시간 로그 */
        .transcript-list {
            margin-top: 24px;
        }

        .transcript-item {
            margin-bottom: 32px;
            position: relative;
            padding-left: 16px;
            border-left: 3px solid #f3f4f6;
            transition: all 0.2s;
        }

        .transcript-item:hover {
            border-left-color: #3b82f6;
        }

        .transcript-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .speaker-name {
            font-weight: 700;
            color: #3b82f6;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .speaker-name:hover {
            color: #2563eb;
        }

        .speaker-name.mapped {
            color: #10b981;
        }

        .time-stamp {
            font-size: 12px;
            color: #9ca3af;
            font-family: 'Courier New', monospace;
        }

        .transcript-text {
            font-size: 15px;
            color: #374151;
            line-height: 1.8;
        }

        .edit-transcript-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: transparent;
            border: none;
            color: #9ca3af;
            padding: 4px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
        }

        .transcript-item:hover .edit-transcript-btn {
            opacity: 1;
        }

        .edit-transcript-btn:hover {
            color: #3b82f6;
        }

        .transcript-meta-info {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: #6b7280;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #f3f4f6;
        }

        .chart-link {
            color: #3b82f6;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        .chart-link:hover {
            color: #2563eb;
        }

        /* 사이드바 */
        .sidebar {
            position: sticky;
            top: 60px;
        }

        .sidebar-section {
            margin-bottom: 40px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 16px;
        }

        /* AI 요약 */
        .summary-block {
            margin-bottom: 20px;
        }

        .summary-label {
            font-size: 11px;
            font-weight: 700;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 6px;
        }

        .summary-text {
            font-size: 14px;
            line-height: 1.7;
            color: #374151;
        }

        .summary-editor {
            width: 100%;
            padding: 8px 0;
            border: none;
            border-bottom: 2px solid #3b82f6;
            font-size: 14px;
            line-height: 1.7;
            resize: vertical;
            min-height: 50px;
            font-family: inherit;
            color: #374151;
        }

        .summary-editor:focus {
            outline: none;
        }

        .edit-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 12px;
        }

        .edit-btn {
            background: transparent;
            border: 1px solid #d1d5db;
            color: #6b7280;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            font-weight: 600;
        }

        .edit-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        /* 키워드 */
        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .keyword {
            padding: 6px 14px;
            background: #f3f4f6;
            color: #374151;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .keyword:hover {
            background: #e5e7eb;
        }

        .keyword.active {
            background: #fef3c7;
            color: #d97706;
        }

        /* 액션 아이템 */
        .action-item {
            padding: 14px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .action-meta {
            font-size: 12px;
            color: #6b7280;
        }

        .add-action-btn {
            margin-top: 12px;
            padding: 10px 0;
            background: transparent;
            color: #3b82f6;
            border: none;
            width: 100%;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-action-btn:hover {
            color: #2563eb;
        }

        /* 하단 버튼 */
        .bottom-actions {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            padding-top: 32px;
            margin-top: 32px;
            border-top: 2px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #f9fafb;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* 모달 */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .modal-desc {
            font-size: 14px;
            color: #6b7280;
        }

        .modal-body {
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .modal-footer {
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* 참여자 리스트 */
        .participant-item {
            padding: 14px 16px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .participant-item:hover {
            background: #eff6ff;
            border-color: #bfdbfe;
        }

        .participant-item.selected {
            background: #eff6ff;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .participant-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        .participant-name {
            flex: 1;
            font-weight: 600;
            color: #111827;
        }

        /* 폼 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* 차트 바 */
        .chart-bar {
            margin-bottom: 16px;
        }

        .chart-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .chart-name {
            font-weight: 600;
            color: #374151;
        }

        .chart-percentage {
            font-weight: 700;
            color: #3b82f6;
        }

        .chart-bar-bg {
            height: 8px;
            background: #f3f4f6;
            border-radius: 999px;
            overflow: hidden;
        }

        .chart-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 999px;
            transition: width 0.3s ease;
        }

        /* 반응형 */
        @media (max-width: 1024px) {
            .main-wrapper {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
            }

            .meeting-title {
                font-size: 24px;
            }

            .area-title {
                font-size: 20px;
            }

            .bottom-actions {
                flex-direction: column;
            }

            .btn-group {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <div class="status-badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
                녹음 완료
            </div>
            <h1 class="meeting-title" onclick="editMeetingTitle()" id="meetingTitle">프로젝트 기획 회의</h1>
            <div class="meeting-meta">
                <div class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span id="meetingDate">2025.10.10 14:00</span>
                </div>
                <div class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span id="meetingDuration">00:45:23</span>
                </div>
                <div class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span id="participantCount">3명 참석</span>
                </div>
            </div>
        </div>

        <!-- 메인 레이아웃 -->
        <div class="main-wrapper">
            <!-- 메인 컨텐츠: 실시간 변환 로그 -->
            <div class="main-content">
                <div class="area-header">
                    <h2 class="area-title">실시간 변환 로그</h2>
                </div>

                <div class="transcript-list" id="transcriptList">
                    <div class="transcript-item">
                        <button class="edit-transcript-btn" onclick="editTranscript(0)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <div class="transcript-meta">
                            <span class="speaker-name" onclick="openSpeakerModal('Speaker 1')">Speaker 1</span>
                            <span class="time-stamp">00:00:15</span>
                        </div>
                        <div class="transcript-text">안녕하세요. 오늘 회의를 시작하겠습니다.</div>
                    </div>

                    <div class="transcript-item">
                        <button class="edit-transcript-btn" onclick="editTranscript(1)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <div class="transcript-meta">
                            <span class="speaker-name" onclick="openSpeakerModal('Speaker 2')">Speaker 2</span>
                            <span class="time-stamp">00:00:32</span>
                        </div>
                        <div class="transcript-text">네, 예산 부분에 대해 논의해야 할 것 같습니다.</div>
                    </div>

                    <div class="transcript-item">
                        <button class="edit-transcript-btn" onclick="editTranscript(2)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <div class="transcript-meta">
                            <span class="speaker-name mapped" onclick="openSpeakerModal('Speaker 1')">김철수</span>
                            <span class="time-stamp">00:01:05</span>
                        </div>
                        <div class="transcript-text">좋습니다. 예산안을 검토해보죠.</div>
                    </div>

                    <div class="transcript-item">
                        <button class="edit-transcript-btn" onclick="editTranscript(3)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <div class="transcript-meta">
                            <span class="speaker-name" onclick="openSpeakerModal('Speaker 3')">Speaker 3</span>
                            <span class="time-stamp">00:01:28</span>
                        </div>
                        <div class="transcript-text">일정도 함께 조율하면 좋겠습니다.</div>
                    </div>

                    <div class="transcript-item">
                        <button class="edit-transcript-btn" onclick="editTranscript(4)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <div class="transcript-meta">
                            <span class="speaker-name mapped" onclick="openSpeakerModal('Speaker 1')">김철수</span>
                            <span class="time-stamp">00:02:10</span>
                        </div>
                        <div class="transcript-text">그렇게 하겠습니다. 다음 주까지 정리하죠.</div>
                    </div>
                </div>

                <div class="transcript-meta-info">
                    <span id="transcriptCount">총 5개 발화</span>
                    <span>•</span>
                    <span id="mappingStatus">1/3 매핑 완료</span>
                    <span>•</span>
                    <span class="chart-link" onclick="openParticipationChart()">발화 점유율 보기</span>
                </div>
            </div>

            <!-- 사이드바 -->
            <div class="sidebar">
                <!-- AI 요약 -->
                <div class="sidebar-section">
                    <div class="area-header">
                        <h3 class="sidebar-title">AI 요약</h3>
                        <button class="edit-btn" onclick="toggleSummaryEdit()">
                            <span id="editBtnText">편집</span>
                        </button>
                    </div>

                    <div class="summary-block">
                        <div class="summary-label">회의 목적</div>
                        <div class="summary-text" id="purposeView">프로젝트 방향성 논의 및 세부 일정 수립</div>
                        <textarea class="summary-editor hidden" id="purposeEditor" placeholder="회의 목적을 입력하세요"></textarea>
                    </div>

                    <div class="summary-block">
                        <div class="summary-label">주요 안건</div>
                        <div class="summary-text" id="agendaView">예산 배정, 일정 조율, 역할 분담</div>
                        <textarea class="summary-editor hidden" id="agendaEditor" placeholder="주요 안건을 입력하세요"></textarea>
                    </div>

                    <div class="summary-block">
                        <div class="summary-label">전체 요약</div>
                        <div class="summary-text" id="summaryView">이번 회의에서는 프로젝트의 주요 목표와 일정에 대해 논의했습니다. 예산안 검토 및 각 팀원의 역할 분담이 이루어졌으며, 다음 주까지 세부 일정을 확정하기로 했습니다.</div>
                        <textarea class="summary-editor hidden" id="summaryEditor" placeholder="전체 요약을 입력하세요"></textarea>
                    </div>

                    <div class="edit-actions hidden" id="editActions">
                        <button class="btn btn-secondary" onclick="cancelSummaryEdit()">취소</button>
                        <button class="btn btn-primary" onclick="saveSummaryEdit()">저장</button>
                    </div>
                </div>

                <!-- 하이라이트 키워드 -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">하이라이트 키워드</h3>
                    <div class="keywords" id="keywords">
                        <div class="keyword" onclick="toggleKeyword(this)">예산</div>
                        <div class="keyword" onclick="toggleKeyword(this)">일정</div>
                        <div class="keyword" onclick="toggleKeyword(this)">역할</div>
                        <div class="keyword" onclick="toggleKeyword(this)">검토</div>
                    </div>
                </div>

                <!-- 액션 아이템 -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">액션 아이템</h3>
                    <div id="actionList">
                        <div class="action-item">
                            <div class="action-title">예산안 작성 및 검토</div>
                            <div class="action-meta">담당: 김철수 · 2025.10.15</div>
                        </div>
                        <div class="action-item">
                            <div class="action-title">일정 조율 회의 예약</div>
                            <div class="action-meta">담당: 이영희 · 2025.10.12</div>
                        </div>
                    </div>
                    <button class="add-action-btn" onclick="openActionModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        액션 아이템 추가
                    </button>
                </div>
            </div>
        </div>

        <!-- 하단 버튼 -->
        <div class="bottom-actions">
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="exportJSON()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    JSON 내보내기
                </button>
                <button class="btn btn-secondary" onclick="exportPDF()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    PDF 내보내기
                </button>
            </div>
            <button class="btn btn-success" onclick="saveMeeting()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
                회의록 저장 및 완료
            </button>
        </div>

        <!-- 발화자 매핑 모달 -->
        <div id="speakerModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">발화자 매핑</h3>
                    <p class="modal-desc">이 발화자를 어떤 참석자와 연결하시겠습니까?</p>
                </div>
                <div class="modal-body">
                    <div id="participantList">
                        <div class="participant-item" onclick="selectParticipant(this, '김철수')">
                            <div class="participant-avatar">김</div>
                            <span class="participant-name">김철수</span>
                        </div>
                        <div class="participant-item" onclick="selectParticipant(this, '이영희')">
                            <div class="participant-avatar">이</div>
                            <span class="participant-name">이영희</span>
                        </div>
                        <div class="participant-item" onclick="selectParticipant(this, '박민수')">
                            <div class="participant-avatar">박</div>
                            <span class="participant-name">박민수</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeSpeakerModal()">취소</button>
                    <button class="btn btn-primary" onclick="saveSpeakerMapping()">확인</button>
                </div>
            </div>
        </div>

        <!-- 발화 점유율 차트 모달 -->
        <div id="chartModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">발화 점유율</h3>
                    <p class="modal-desc">참석자별 발화 비율을 확인하세요</p>
                </div>
                <div class="modal-body">
                    <div id="chartContainer">
                        <div class="chart-bar">
                            <div class="chart-label">
                                <span class="chart-name">김철수</span>
                                <span class="chart-percentage">40% (2회)</span>
                            </div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 40%"></div>
                            </div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">
                                <span class="chart-name">Speaker 2</span>
                                <span class="chart-percentage">20% (1회)</span>
                            </div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 20%"></div>
                            </div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">
                                <span class="chart-name">Speaker 3</span>
                                <span class="chart-percentage">20% (1회)</span>
                            </div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 20%"></div>
                            </div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">
                                <span class="chart-name">Speaker 1</span>
                                <span class="chart-percentage">20% (1회)</span>
                            </div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 20%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="closeChartModal()">확인</button>
                </div>
            </div>
        </div>

        <!-- 액션 아이템 추가 모달 -->
        <div id="actionModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">액션 아이템 추가</h3>
                    <p class="modal-desc">할 일의 상세 정보를 입력해주세요</p>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">액션 아이템 <span style="color: #ef4444;">*</span></label>
                        <textarea id="actionTitle" class="form-textarea" placeholder="예: 예산안 작성 및 검토"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">담당자</label>
                            <select id="actionAssignee" class="form-select">
                                <option value="">선택하세요</option>
                                <option value="김철수">김철수</option>
                                <option value="이영희">이영희</option>
                                <option value="박민수">박민수</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">기한</label>
                            <input type="date" id="actionDeadline" class="form-input">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeActionModal()">취소</button>
                    <button class="btn btn-primary" onclick="saveAction()">추가</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* 공통 메시지 */
        function showSuccessMessage(msg) {
            const div = document.createElement("div");
            div.className = "success-toast";
            div.textContent = msg;
            Object.assign(div.style, {
                position: "fixed",
                top: "24px",
                right: "24px",
                background: "#10b981",
                color: "#fff",
                padding: "12px 20px",
                borderRadius: "8px",
                zIndex: "9999",
            });
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2500);
        }

        function showErrorMessage(msg) {
            const div = document.createElement("div");
            div.className = "error-toast";
            div.textContent = msg;
            Object.assign(div.style, {
                position: "fixed",
                top: "24px",
                right: "24px",
                background: "#ef4444",
                color: "#fff",
                padding: "12px 20px",
                borderRadius: "8px",
                zIndex: "9999",
            });
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2500);
        }

        /* 전역 변수 */
        let meetingData = null;
        let speakerMappingData = {};
        let actionItems = [];
        let currentEditingTranscriptIndex = -1;
        let activeKeyword = null;
        let isEditingSummary = false;
        let originalSummaryData = {};
        let currentMappingSpeaker = null;

        /* 회의 데이터 로드 */
        function loadMeetingData() {
            if (!meetingData) return;
            actionItems = meetingData.actions || [];
            displayMeetingInfo();
            displayTranscripts();
            generateAISummary();
            renderActionItems();
        }

        /* 회의 정보 표시 */
        function displayMeetingInfo() {
            const title = meetingData.title || "제목 없음";
            document.getElementById("meetingTitle").textContent = title;

            const dateEl = document.getElementById("meetingDate");
            if (meetingData.date && dateEl) {
                const date = new Date(meetingData.date);
                dateEl.textContent = `${date.getFullYear()}.${String(
                    date.getMonth() + 1
                ).padStart(2, "0")}.${String(date.getDate()).padStart(2, "0")} ${String(
                    date.getHours()
                ).padStart(2, "0")}:${String(date.getMinutes()).padStart(2, "0")}`;
            }

            const dur = document.getElementById("meetingDuration");
            if (meetingData.duration && dur)
                dur.textContent = formatDuration(meetingData.duration);

            const part = document.getElementById("participantCount");
            if (meetingData.participants && part)
                part.textContent = meetingData.participants.length + "명 참석";
        }

        function formatDuration(sec) {
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = sec % 60;
            return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
        }

        /* 회의 제목 수정 */
        function editMeetingTitle() {
            const el = document.getElementById("meetingTitle");
            const cur = el.textContent;
            const newTitle = prompt("회의 제목을 입력하세요:", cur);
            if (newTitle && newTitle.trim()) {
                meetingData.title = newTitle.trim();
                el.textContent = newTitle.trim();
                showSuccessMessage("회의 제목이 수정되었습니다.");
            }
        }

        /* 키워드 하이라이트 */
        function highlightKeywords(text) {
            if (!activeKeyword) return text;
            const regex = new RegExp("(" + activeKeyword + ")", "gi");
            return text.replace(
                regex,
                '<mark style="background:#fef3c7;color:#d97706;padding:2px 4px;border-radius:3px;">$1</mark>'
            );
        }

        /* 실시간 로그 표시 */
        function displayTranscripts() {
            if (!meetingData || !meetingData.transcripts) return;
            const body = document.getElementById("transcriptList");
            body.innerHTML = "";
            
            meetingData.transcripts.forEach((transcript, index) => {
                const item = document.createElement("div");
                item.className = "transcript-item";
                item.setAttribute("data-index", index);
                
                const speakerClass = speakerMappingData[transcript.speaker] ? "mapped" : "";
                const displayName = speakerMappingData[transcript.speaker] || transcript.speaker;
                
                item.innerHTML = `
                    <button class="edit-transcript-btn" onclick="editTranscript(${index})" title="수정">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                    <div class="transcript-meta">
                        <span class="speaker-name ${speakerClass}" onclick="openSpeakerModal('${transcript.speaker}')">${displayName}</span>
                        <span class="time-stamp">${transcript.time}</span>
                    </div>
                    <div class="transcript-text" id="transcript-text-${index}">${highlightKeywords(transcript.text)}</div>
                `;
                body.appendChild(item);
            });
            updateTranscriptStats();
        }

        /* 로그 통계 업데이트 */
        function updateTranscriptStats() {
            const countEl = document.getElementById("transcriptCount");
            const mappingEl = document.getElementById("mappingStatus");

            if (!meetingData || !meetingData.transcripts) return;

            const total = meetingData.transcripts.length;
            const uniqueSpeakers = [...new Set(meetingData.transcripts.map(t => t.speaker))];
            const mappedCount = uniqueSpeakers.filter(s => speakerMappingData[s]).length;

            if (countEl) countEl.textContent = `총 ${total}개 발화`;
            if (mappingEl) mappingEl.textContent = `${mappedCount}/${uniqueSpeakers.length} 매핑 완료`;
        }

        /* 발화자 매핑 */
        function openSpeakerModal(speaker) {
            currentMappingSpeaker = speaker;
            const modal = document.getElementById("speakerModal");
            const list = document.getElementById("participantList");
            list.innerHTML = "";
            
            meetingData.participants.forEach(p => {
                const item = document.createElement("div");
                item.className = "participant-item";
                if (speakerMappingData[speaker] === p) item.classList.add("selected");
                item.innerHTML = `
                    <div class="participant-avatar">${p.charAt(0)}</div>
                    <span class="participant-name">${p}</span>
                `;
                item.onclick = () => selectParticipant(item, p);
                list.appendChild(item);
            });
            
            modal.classList.remove("hidden");
            document.body.style.overflow = "hidden";
        }

        function selectParticipant(item, participant) {
            document.querySelectorAll(".participant-item").forEach(el => el.classList.remove("selected"));
            item.classList.add("selected");
            speakerMappingData[currentMappingSpeaker] = participant;
        }

        function saveSpeakerMapping() {
            closeSpeakerModal();
            displayTranscripts();
            showSuccessMessage("발화자 매핑이 저장되었습니다.");
        }

        function closeSpeakerModal() {
            const modal = document.getElementById("speakerModal");
            modal.classList.add("hidden");
            document.body.style.overflow = "";
        }

        /* 발화 점유율 차트 */
        function openParticipationChart() {
            if (!meetingData || !meetingData.transcripts) {
                showErrorMessage("회의 데이터가 없습니다.");
                return;
            }

            const speakerCounts = {};
            meetingData.transcripts.forEach(t => {
                const speaker = speakerMappingData[t.speaker] || t.speaker;
                speakerCounts[speaker] = (speakerCounts[speaker] || 0) + 1;
            });

            const total = meetingData.transcripts.length;
            const chartData = Object.entries(speakerCounts).map(([speaker, count]) => ({
                speaker,
                count,
                percentage: ((count / total) * 100).toFixed(1)
            }));

            chartData.sort((a, b) => b.count - a.count);

            const container = document.getElementById("chartContainer");
            container.innerHTML = "";

            chartData.forEach(data => {
                const barDiv = document.createElement("div");
                barDiv.className = "chart-bar";
                barDiv.innerHTML = `
                    <div class="chart-label">
                        <span class="chart-name">${data.speaker}</span>
                        <span class="chart-percentage">${data.percentage}% (${data.count}회)</span>
                    </div>
                    <div class="chart-bar-bg">
                        <div class="chart-bar-fill" style="width: ${data.percentage}%"></div>
                    </div>
                `;
                container.appendChild(barDiv);
            });

            const modal = document.getElementById("chartModal");
            modal.classList.remove("hidden");
            document.body.style.overflow = "hidden";
        }

        function closeChartModal() {
            const modal = document.getElementById("chartModal");
            modal.classList.add("hidden");
            document.body.style.overflow = "";
        }

        /* AI 요약 편집 */
        function toggleSummaryEdit() {
            isEditingSummary = !isEditingSummary;
            const editBtn = document.getElementById("editBtnText");
            const editActions = document.getElementById("editActions");

            const sections = [
                { view: "purposeView", editor: "purposeEditor" },
                { view: "agendaView", editor: "agendaEditor" },
                { view: "summaryView", editor: "summaryEditor" },
            ];

            if (isEditingSummary) {
                editBtn.textContent = "편집 중";
                editActions.classList.remove("hidden");
                originalSummaryData = {};
                sections.forEach(({ view, editor }) => {
                    const viewEl = document.getElementById(view);
                    const editEl = document.getElementById(editor);
                    const text = viewEl.textContent.trim();
                    originalSummaryData[view] = text;
                    editEl.value = text;
                    viewEl.classList.add("hidden");
                    editEl.classList.remove("hidden");
                });
            } else {
                editBtn.textContent = "편집";
                editActions.classList.add("hidden");
                sections.forEach(({ view, editor }) => {
                    const viewEl = document.getElementById(view);
                    const editEl = document.getElementById(editor);
                    viewEl.classList.remove("hidden");
                    editEl.classList.add("hidden");
                });
            }
        }

        function saveSummaryEdit() {
            ["purpose", "agenda", "summary"].forEach(id => {
                const editor = document.getElementById(`${id}Editor`);
                const view = document.getElementById(`${id}View`);
                view.textContent = editor.value.trim() || "내용 없음";
            });
            toggleSummaryEdit();
            showSuccessMessage("AI 요약이 저장되었습니다.");
        }

        function cancelSummaryEdit() {
            ["purpose", "agenda", "summary"].forEach(id => {
                const view = document.getElementById(`${id}View`);
                view.textContent = originalSummaryData[`${id}View`];
            });
            toggleSummaryEdit();
        }

        /* AI 요약 표시 */
        function generateAISummary() {
            document.getElementById("purposeView").textContent = meetingData.purpose || "회의 목적 없음";
            document.getElementById("agendaView").textContent = meetingData.agenda || "의제 없음";
            document.getElementById("summaryView").textContent = meetingData.summary || "요약 내용이 없습니다.";

            const kwContainer = document.getElementById("keywords");
            kwContainer.innerHTML = "";
            (meetingData.keywords || []).forEach(k => {
                const tag = document.createElement("div");
                tag.className = "keyword";
                tag.textContent = k;
                tag.onclick = () => toggleKeyword(tag, k);
                kwContainer.appendChild(tag);
            });
        }

        function toggleKeyword(el, keyword) {
            if (activeKeyword === keyword) {
                activeKeyword = null;
                el.classList.remove("active");
            } else {
                document.querySelectorAll(".keyword").forEach(tag => tag.classList.remove("active"));
                el.classList.add("active");
                activeKeyword = keyword;
            }
            displayTranscripts();
        }

        /* 액션 아이템 */
        function renderActionItems() {
            const container = document.getElementById("actionList");
            container.innerHTML = "";
            actionItems.forEach(a => {
                const div = document.createElement("div");
                div.className = "action-item";
                div.innerHTML = `
                    <div class="action-title">${a.title}</div>
                    <div class="action-meta">${a.assignee ? `담당: ${a.assignee}` : ""}${a.assignee && a.deadline ? " · " : ""}${a.deadline || ""}</div>
                `;
                container.appendChild(div);
            });
        }

        function openActionModal() {
            const modal = document.getElementById("actionModal");
            document.getElementById("actionTitle").value = "";
            document.getElementById("actionAssignee").value = "";
            document.getElementById("actionDeadline").value = "";

            const assigneeSelect = document.getElementById("actionAssignee");
            assigneeSelect.innerHTML = '<option value="">선택하세요</option>';
            if (meetingData && meetingData.participants) {
                meetingData.participants.forEach(p => {
                    const option = document.createElement("option");
                    option.value = p;
                    option.textContent = p;
                    assigneeSelect.appendChild(option);
                });
            }

            modal.classList.remove("hidden");
            document.body.style.overflow = "hidden";
        }

        function closeActionModal() {
            const modal = document.getElementById("actionModal");
            modal.classList.add("hidden");
            document.body.style.overflow = "";
        }

        function saveAction() {
            const title = document.getElementById("actionTitle").value.trim();
            if (!title) {
                showErrorMessage("액션 아이템을 입력해주세요.");
                return;
            }

            const assignee = document.getElementById("actionAssignee").value;
            const deadline = document.getElementById("actionDeadline").value;

            actionItems.push({ title, assignee, deadline });
            renderActionItems();
            closeActionModal();
            showSuccessMessage("액션 아이템이 추가되었습니다.");
        }

        /* 로그 수정 */
        function editTranscript(index) {
            if (currentEditingTranscriptIndex !== -1) {
                cancelTranscriptEdit(currentEditingTranscriptIndex);
            }
            currentEditingTranscriptIndex = index;

            const item = document.querySelector(`.transcript-item[data-index="${index}"]`);
            const textDiv = item.querySelector(".transcript-text");
            const originalText = meetingData.transcripts[index].text;

            textDiv.innerHTML = `
                <textarea class="summary-editor" id="transcript-editor-${index}" style="width: 100%; padding: 8px; border: 2px solid #3b82f6; border-radius: 8px; font-size: 15px; line-height: 1.7; resize: vertical; min-height: 60px; margin-top: 8px;">${originalText}</textarea>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px;">
                    <button class="btn btn-secondary" onclick="cancelTranscriptEdit(${index})">취소</button>
                    <button class="btn btn-primary" onclick="saveTranscriptEdit(${index})">저장</button>
                </div>
            `;
            const editor = document.getElementById(`transcript-editor-${index}`);
            editor.focus();
        }

        function saveTranscriptEdit(index) {
            const editor = document.getElementById(`transcript-editor-${index}`);
            const newText = editor.value.trim();
            if (!newText) {
                showErrorMessage("내용을 입력해주세요.");
                return;
            }

            meetingData.transcripts[index].text = newText;
            currentEditingTranscriptIndex = -1;
            displayTranscripts();
            showSuccessMessage("발화 로그가 수정되었습니다.");
        }

        function cancelTranscriptEdit(index) {
            currentEditingTranscriptIndex = -1;
            displayTranscripts();
        }

        /* 저장 및 내보내기 */
        function collectFinalData() {
            return {
                ...meetingData,
                speakerMapping: speakerMappingData,
                actions: actionItems,
                createdAt: new Date().toISOString(),
            };
        }

        function exportJSON() {
            const data = collectFinalData();
            const blob = new Blob([JSON.stringify(data, null, 2)], {
                type: "application/json",
            });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `${meetingData.title || "meeting"}.json`;
            a.click();
            showSuccessMessage("JSON 파일이 다운로드되었습니다.");
        }

        function exportPDF() {
            showErrorMessage("PDF 내보내기 기능은 준비 중입니다.");
        }

        function saveMeeting() {
            const data = collectFinalData();
            localStorage.setItem("savedMeeting", JSON.stringify(data));
            showSuccessMessage("회의록이 저장되었습니다.");
        }

        /* 초기화 */
        document.addEventListener("DOMContentLoaded", () => {
            const stored = localStorage.getItem("lastMeeting");
            if (stored) {
                meetingData = JSON.parse(stored);
                loadMeetingData();
            } else {
                // 테스트 데이터
                meetingData = {
                    title: "프로젝트 기획 회의",
                    date: new Date().toISOString(),
                    duration: 2723,
                    participants: ["김철수", "이영희", "박민수"],
                    transcripts: [
                        { speaker: "Speaker 1", time: "00:00:15", text: "안녕하세요. 오늘 회의를 시작하겠습니다." },
                        { speaker: "Speaker 2", time: "00:00:32", text: "네, 예산 부분에 대해 논의해야 할 것 같습니다." },
                        { speaker: "Speaker 1", time: "00:01:05", text: "좋습니다. 예산안을 검토해보죠." },
                        { speaker: "Speaker 3", time: "00:01:28", text: "일정도 함께 조율하면 좋겠습니다." },
                        { speaker: "Speaker 1", time: "00:02:10", text: "그렇게 하겠습니다. 다음 주까지 정리하죠." }
                    ],
                    purpose: "프로젝트 방향성 논의 및 세부 일정 수립",
                    agenda: "예산 배정, 일정 조율, 역할 분담",
                    summary: "이번 회의에서는 프로젝트의 주요 목표와 일정에 대해 논의했습니다. 예산안 검토 및 각 팀원의 역할 분담이 이루어졌으며, 다음 주까지 세부 일정을 확정하기로 했습니다.",
                    keywords: ["예산", "일정", "역할", "검토"],
                    actions: []
                };
                loadMeetingData();
            }
        });
    </script>
</body>
</html>